<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Recette ‚Äì Vauban</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta name="theme-color" content="#222222">
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <a href="index.html">‚Üê Retour aux recettes</a>
    <h1 id="title"></h1>
  </header>

  <main>
    <section>
      <h2>Ingr√©dients</h2>
      <ul id="ingredients"></ul>
    </section>
    <section>
      <h2>Proc√©d√©</h2>
      <ol id="instructions"></ol>
    </section>
  </main>

  <script>
    // üîó M√™me URL que dans index.html
    const API_URL = 'https://script.google.com/macros/s/AKfycbwoUtzG1-DlkSWNvaoDpR6xqH7azD0UkmKbWNo1BTD2fFAQlrwtGUilEjYrqNPikMbFHg/exec';

    function getParam(name) {
      const url = new URL(window.location.href);
      return url.searchParams.get(name);
    }

    async function loadRecipe() {
      const id = getParam('id');
      const titleEl = document.getElementById('title');
      const ingList = document.getElementById('ingredients');
      const instList = document.getElementById('instructions');

      if (!id) {
        titleEl.textContent = 'Recette introuvable';
        return;
      }

      try {
        const res = await fetch(API_URL + '?type=recipes');
        const data = await res.json();

        if (data.error) {
          titleEl.textContent = 'Erreur : ' + data.error;
          return;
        }

        const recipes = data.recipes || [];
        const recipe = recipes.find(r => r.id === id);

        if (!recipe) {
          titleEl.textContent = 'Recette introuvable';
          return;
        }

        titleEl.textContent = recipe.name;

        // Ingr√©dients
        ingList.innerHTML = '';
        (recipe.ingredients || []).forEach(i => {
          const li = document.createElement('li');
          const qty = (i.quantity !== null && i.quantity !== '' && !isNaN(i.quantity))
            ? i.quantity
            : '';
          const unit = i.unit || '';
          li.textContent = `${qty ? qty + ' ' : ''}${unit} ‚Äì ${i.name}`;
          ingList.appendChild(li);
        });

        // Instructions
        instList.innerHTML = '';
        (recipe.instructions || []).forEach(step => {
          const li = document.createElement('li');
          li.textContent = step;
          instList.appendChild(li);
        });

      } catch (e) {
        console.error(e);
        titleEl.textContent = 'Erreur de chargement de la recette';
      }
    }

    loadRecipe();

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js').catch(console.error);
    }
  </script>
</body>
</html>

