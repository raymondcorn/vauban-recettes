<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Inventaire ‚Äì Vauban</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta name="theme-color" content="#222222">
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <a href="index.html">‚Üê Recettes</a>
    <h1>Inventaire produits</h1>
  </header>

  <main>
    <section>
      <p id="inv-info">Chargement de l‚Äôinventaire‚Ä¶</p>

      <table id="inv-table" style="width:100%; border-collapse:collapse; display:none;">
        <thead>
          <tr>
            <th style="text-align:left; padding:4px;">Produit</th>
            <th style="text-align:left; padding:4px;">Fournisseur</th>
            <th style="text-align:right; padding:4px;">Prix HT</th>
            <th style="text-align:left; padding:4px;">Unit√©</th>
            <th style="text-align:right; padding:4px;">Stock</th>
            <th style="text-align:right; padding:4px;">Valeur stock</th>
          </tr>
        </thead>
        <tbody></tbody>
        <tfoot>
          <tr>
            <th colspan="5" style="text-align:right; padding:4px;">TOTAL INVENTAIRE (‚Ç¨)</th>
            <th id="inv-total" style="text-align:right; padding:4px;"></th>
          </tr>
        </tfoot>
      </table>
    </section>
  </main>

  <script>
    // üîó m√™me URL que dans index.html / recipe.html
    const API_URL = 'https://script.google.com/macros/s/AKfycbzu4wXxbw774dyAuIMI0qIYfekE7rvs9AAvppHuFyy1obfwuCxqof0sbNfR7BNkUWKWxw/exec'; // ‚Üê √† remplacer

    async function loadInventory() {
      const info = document.getElementById('inv-info');
      const table = document.getElementById('inv-table');
      const tbody = table.querySelector('tbody');
      const totalCell = document.getElementById('inv-total');

      try {
        const res = await fetch(API_URL + '?type=inventory');
        const data = await res.json();

        if (data.error) {
          info.textContent = 'Erreur : ' + data.error;
          return;
        }

        const products = data.products || [];
        const total = data.totalInventory || 0;

        if (!products.length) {
          info.textContent = 'Aucun produit trouv√©.';
          return;
        }

        info.style.display = 'none';
        table.style.display = 'table';

        products.forEach(p => {
          const tr = document.createElement('tr');

          function td(txt, align) {
            const cell = document.createElement('td');
            cell.textContent = txt;
            cell.style.padding = '4px';
            if (align) cell.style.textAlign = align;
            return cell;
          }

          tr.appendChild(td(p.name, 'left'));
          tr.appendChild(td(p.supplier || '', 'left'));
          tr.appendChild(td(
            p.priceHt != null && !isNaN(p.priceHt) ? p.priceHt.toFixed(2) : '',
            'right'
          ));
          tr.appendChild(td(p.unit || '', 'left'));
          tr.appendChild(td(
            p.stock != null && p.stock !== '' ? p.stock : '',
            'right'
          ));
          tr.appendChild(td(
            p.stockValue != null && !isNaN(p.stockValue) ? p.stockValue.toFixed(2) : '',
            'right'
          ));

          tbody.appendChild(tr);
        });

        totalCell.textContent = total && !isNaN(total) ? total.toFixed(2) : '0.00';

      } catch (e) {
        console.error(e);
        info.textContent = 'Erreur de chargement de l‚Äôinventaire.';
      }
    }

    loadInventory();

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js').catch(console.error);
    }
  </script>
</body>
</html>
