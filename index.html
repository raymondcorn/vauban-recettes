<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Recettes â€“ Vauban</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Couleur de la barre (mobile) -->
  <meta name="theme-color" content="#222222">

  <!-- Manifest PWA -->
  <link rel="manifest" href="manifest.json">

  <!-- CSS -->
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>Recettes du Vauban</h1>
    <div style="display:flex; gap:0.5rem; align-items:center; flex-wrap:wrap;">
      <input id="search" type="text" placeholder="Rechercher une recette...">
      <a href="inventory.html" style="margin-left:auto; color:#ffd54f; text-decoration:none; font-size:0.9rem;">
        Voir lâ€™inventaire â†’
      </a>
    </div>
  </header>

  <main id="recipe-list"></main>

  <script>
    // ðŸ”— URL de lâ€™API Apps Script (celle qui finit par /exec)
    const API_URL = 'https://script.google.com/macros/s/AKfycbzu4wXxbw774dyAuIMI0qIYfekE7rvs9AAvppHuFyy1obfwuCxqof0sbNfR7BNkUWKWxw/exec';

    async function loadRecipes() {
      const list = document.getElementById('recipe-list');
      const searchInput = document.getElementById('search');

      list.innerHTML = '<p>Chargement des recettes...</p>';

      try {
        const res = await fetch(API_URL + '?type=recipes');
        const data = await res.json();

        if (data.error) {
          list.innerHTML = '<p>Erreur : ' + data.error + '</p>';
          return;
        }

        const recipes = data.recipes || [];

        function render(filter = '') {
          list.innerHTML = '';
          recipes
            .filter(r => r.name.toLowerCase().includes(filter.toLowerCase()))
            .forEach(r => {
              const card = document.createElement('a');
              card.className = 'card';
              card.href = 'recipe.html?id=' + encodeURIComponent(r.id);
              card.innerHTML = `
                <h2>${r.name}</h2>
                <p>${r.category || ''}</p>
              `;
              list.appendChild(card);
            });

          if (!recipes.length) {
            list.innerHTML = '<p>Aucune recette trouvÃ©e.</p>';
          }
        }

        render();

        searchInput.addEventListener('input', e => {
          render(e.target.value);
        });

      } catch (e) {
        console.error(e);
        list.innerHTML = '<p>Erreur de chargement des recettes.</p>';
      }
    }

    loadRecipes();

    // âœ… Enregistrement du service worker (PWA)
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js').catch(console.error);
    }
  </script>
</body>
</html>
